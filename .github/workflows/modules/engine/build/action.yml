name: Build engine
description: Build engine
# riznia
runs:
  using: 'composite'
  steps:
    - name: Setup conan base
      uses: ./.github/workflows/utils/setup-conan

    - name: Install dependencies
      uses: ./.github/workflows/modules/engine/install-dependencies

    - name: Setup ultralight base
      uses: ./.github/workflows/utils/setup-ultralight

    - name: Prepare engine env
      uses: ./.github/workflows/modules/engine/setup-env

    - name: Prepare assets
      uses: ./.github/workflows/modules/engine/assets

    - name: Build game
      run:   |
        if [ "$RUNNER_OS" == "Linux" ]; then
          export CC=clang
          export CXX=clang++

          cmake --build $(pwd)/build/Debug --parallel 10 --target game
        elif [ "$RUNNER_OS" == "macOS" ]; then
          cmake --build $(pwd)/build/Debug --parallel 10 --target game
        elif [ "$RUNNER_OS" == "Windows" ]; then
          export CC=clang
          export CXX=clang++

          cmake -G "Unix Makefiles" -DCMAKE_BUILD_TYPE=Debug -DCMAKE_TOOLCHAIN_FILE="D:\a\dreich\dreich\build\Debug\generators\conan_toolchain.cmake" -S "D:\a\dreich\dreich" -B "D:\a\dreich\dreich\build\Debug"
          cmake --build "D:\a\dreich\dreich\build\Debug" --parallel 10 --target game
        else
          echo "$RUNNER_OS not supported"
          exit 1
        fi
      shell: bash
